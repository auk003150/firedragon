<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>å¤§å‘èˆç«é¾ AR éŠæˆ²</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #score { position: absolute; top: 10px; left: 10px; color: white; font-size: 24px; z-index: 1; }
        #mirror-btn { position: absolute; top: 10px; right: 10px; z-index: 1; padding: 10px; background: #fff; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <div id="score">åˆ†æ•¸: 0</div>
    <button id="mirror-btn">åˆ‡æ›é¡åƒ</button>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <!-- èƒŒæ™¯ï¼šå¤§å‘èˆç«é¾å…¨æ™¯åœ– -->
        <a-sky src="https://www.discoverhongkong.com/content/dam/dhk/intl/explore/culture/tai-hang-fire-dragon-dance/fire-dragon-mainvisual.jpg" rotation="0 -90 0"></a-sky>

        <!-- Hiro marker èˆ‡ AR ç‰©ä»¶ï¼ˆç«¹ + ç…™èŠ±ï¼‰ -->
        <a-marker preset="hiro" id="dragon-marker">
            <!-- ç«¹æ£ï¼šåœ“æŸ±é«” -->
            <a-cylinder position="0 0.5 0" radius="0.05" height="1" color="brown"></a-cylinder>
            <!-- ç…™èŠ±ï¼šå¤šå€‹å°çƒé«” -->
            <a-sphere position="0 1.2 0" radius="0.1" color="red"></a-sphere>
            <a-sphere position="0.1 1.3 0.1" radius="0.08" color="yellow"></a-sphere>
            <a-sphere position="-0.1 1.3 0.1" radius="0.08" color="orange"></a-sphere>
            <a-sphere position="0 1.3 -0.1" radius="0.08" color="gold"></a-sphere>
        </a-marker>

        <!-- æ”åƒé ­å¯¦é«” -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const relatedWords = ['ç¦', 'æ˜¥', 'è²¡', 'å®‰', 'æ—º', 'å‰', 'ç¥¥', 'è³€', 'é¾', 'å¹´'];
        const unrelatedSymbols = ['âš½', 'ğŸ”', 'ğŸ§', 'ğŸ§Š', 'ğŸ§¼', 'ğŸº', 'ğŸ’¡', 'ğŸ“', 'ğŸ§½', 'ğŸ§¯'];
        const allItems = [...relatedWords, ...unrelatedSymbols];
        let score = 0;
        let items = [];
        const scene = document.querySelector('a-scene');
        const marker = document.querySelector('#dragon-marker');
        const video = document.querySelector('video'); // AR.js æœƒè‡ªå‹•ç”¢ç”Ÿ video å…ƒç´ 
        let isMirrored = false;

        // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
        function updateScore() {
            document.getElementById('score').innerText = `åˆ†æ•¸: ${score}`;
        }

        // ç”Ÿæˆéš¨æ©Ÿç‰©ä»¶
        function createItem() {
            const itemText = allItems[Math.floor(Math.random() * allItems.length)];
            const isRelated = relatedWords.includes(itemText);
            const item = document.createElement('a-text');
            item.setAttribute('value', itemText);
            item.setAttribute('color', isRelated ? 'green' : 'red');
            item.setAttribute('scale', '0.5 0.5 0.5');
            item.setAttribute('position', `${Math.random() * 4 - 2} ${Math.random() * 4 - 2} -3`); // éš¨æ©Ÿä½ç½®åœ¨ z=-3 å‰æ–¹
            scene.appendChild(item);
            items.push({ entity: item, isRelated });
        }

        // æª¢æŸ¥ç¢°æ’
        function checkCollisions() {
            if (!marker.object3D.visible) return; // marker æœªåµæ¸¬åˆ°æ™‚ä¸æª¢æŸ¥
            const markerPos = new THREE.Vector3();
            marker.object3D.getWorldPosition(markerPos);

            items.forEach((item, index) => {
                const itemPos = new THREE.Vector3();
                item.entity.object3D.getWorldPosition(itemPos);
                const distance = markerPos.distanceTo(itemPos);

                if (distance < 0.5) { // ç¢°æ’é–¾å€¼
                    if (item.isRelated) {
                        score += 15;
                    } else {
                        score -= 5;
                    }
                    updateScore();
                    scene.removeChild(item.entity);
                    items.splice(index, 1);
                } else {
                    // ç‰©ä»¶ç·©æ…¢ç§»å‹•å‘ç©å®¶ (z æ–¹å‘)
                    const pos = item.entity.getAttribute('position');
                    pos.z += 0.01;
                    item.entity.setAttribute('position', pos);
                }
            });
        }

        // é¡åƒåˆ‡æ›
        document.getElementById('mirror-btn').addEventListener('click', () => {
            isMirrored = !isMirrored;
            if (video) {
                video.style.transform = isMirrored ? 'scaleX(-1)' : 'scaleX(1)';
            }
        });

        // åˆå§‹åŒ–ï¼šç”Ÿæˆåˆå§‹ç‰©ä»¶
        for (let i = 0; i < 5; i++) {
            createItem();
        }

        // æ¯ç§’ç”Ÿæˆæ–°ç‰©ä»¶ä¸¦æª¢æŸ¥ç¢°æ’
        setInterval(() => {
            createItem();
            checkCollisions();
        }, 1000);

        // æ¯å¹€æª¢æŸ¥ç¢°æ’
        scene.addEventListener('enter-vr', checkCollisions); // ä½†å¯¦éš›ç”¨ tick
        AFRAME.registerComponent('collision-check', {
            tick: checkCollisions
        });
        scene.setAttribute('collision-check', '');
    </script>
</body>
</html>
