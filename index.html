<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>AR æŠ“å¯¶éŠæˆ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; }
    
    /* UI ä»‹é¢å±¤ */
    #ui-layer {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 100;
      display: flex; flex-direction: column; justify-content: space-between;
    }

    /* åˆ†æ•¸æ¿ */
    .score-board {
      padding: 20px;
      display: flex; justify-content: space-between; align-items: flex-start;
    }
    .score-box {
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 10px 20px;
      border-radius: 12px;
      border: 2px solid #fff;
      font-size: 24px;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .score-change {
      position: absolute;
      font-size: 40px;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.5s, transform 0.5s;
    }

    /* åº•éƒ¨æç¤º */
    .footer {
      background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <!-- UI ä»‹é¢ -->
  <div id="ui-layer">
    <div class="score-board">
      <div class="score-box">åˆ†æ•¸: <span id="score-val">0</span></div>
      <div id="score-anim" class="score-change"></div>
    </div>
    <div class="footer">
      ç§»å‹• Hiro æ¨™è¨˜å»è§¸ç¢°æ¼‚æµ®çš„å­—ï¼<br>
      <span style="color: #4cd137">å‰ç¥¥è©± +15</span> | <span style="color: #e84118">é›œç‰© -5</span>
    </div>
  </div>

  <!-- A-Frame å ´æ™¯ -->
  <a-scene
    vr-mode-ui="enabled: false"
    embedded
    renderer="logarithmicDepthBuffer: true; antialias: true;"
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono;"
  >
    
    <!-- éŠæˆ²é‚è¼¯ç®¡ç†å™¨ (ä¸å¯è¦‹) -->
    <a-entity id="game-manager"></a-entity>

    <!-- ç©å®¶ (Hiro Marker) -->
    <a-marker preset="hiro" id="player-marker">
      <!-- é€™æ˜¯ç©å®¶çš„ã€Œç¶²å­ã€æˆ–ã€Œæº–å¿ƒã€ï¼Œç”¨ä¾†ç¢°æ’ç‰©é«” -->
      <a-entity id="player-collider">
        <!-- è¦–è¦ºä¸Šçš„æº–å¿ƒ -->
        <a-ring radius-inner="0.3" radius-outer="0.35" color="#f1c40f" rotation="-90 0 0"></a-ring>
        <a-cone radius-bottom="0.35" radius-top="0" height="0.5" color="#f1c40f" opacity="0.3" rotation="0 0 0" position="0 0.25 0"></a-cone>
        <!-- æ ¸å¿ƒç¢°æ’é»é¡¯ç¤º -->
        <a-sphere radius="0.1" color="red" position="0 0.25 0" opacity="0.8"></a-sphere>
      </a-entity>
    </a-marker>

    <!-- ç›¸æ©Ÿï¼šæ¼‚æµ®æ–‡å­—å°‡æœƒä½œç‚ºç›¸æ©Ÿçš„å­ç‰©ä»¶ç”Ÿæˆï¼Œé€™æ¨£å®ƒå€‘æœƒæ°¸é åœ¨è¢å¹•å‰æ–¹ -->
    <a-entity camera id="camera-rig"></a-entity>

  </a-scene>

  <script>
    // --- éŠæˆ²è¨­å®š ---
    const GOOD_WORDS = ['ç¦', 'æ˜¥', 'è²¡', 'å®‰', 'æ—º', 'å‰', 'ç¥¥', 'è³€', 'é¾', 'å¹´'];
    const BAD_WORDS = ['âš½', 'ğŸ”', 'ğŸ§', 'ğŸ§Š', 'ğŸ§¼', 'ğŸº', 'ğŸ’¡', 'ğŸ“', 'ğŸ§½', 'ğŸ§¯'];
    
    const SPAWN_INTERVAL = 1500; // æ¯«ç§’ï¼šç”Ÿæˆé€Ÿåº¦
    const MOVE_SPEED = 0.005;    // ç§»å‹•é€Ÿåº¦
    const COLLISION_DISTANCE = 0.4; // ç¢°æ’è·é›¢åˆ¤å®š (ç±³)

    let score = 0;
    const scoreEl = document.getElementById('score-val');
    const scoreAnimEl = document.getElementById('score-anim');
    const scene = document.querySelector('a-scene');
    const cameraRig = document.querySelector('#camera-rig');
    const playerCollider = document.querySelector('#player-collider');
    const playerMarker = document.querySelector('#player-marker');

    // --- è¼”åŠ©å‡½å¼ï¼šç”¨ Canvas ç¹ªè£½æ–‡å­—è²¼åœ– ---
    // é€™è§£æ±ºäº† A-Frame é è¨­ä¸æ”¯æ´ä¸­æ–‡å’Œ Emoji çš„å•é¡Œ
    function createTextTexture(text, isBad) {
      const canvas = document.createElement('canvas');
      canvas.width = 256;
      canvas.height = 256;
      const ctx = canvas.getContext('2d');

      // èƒŒæ™¯åœ“åœˆ
      ctx.beginPath();
      ctx.arc(128, 128, 120, 0, 2 * Math.PI);
      ctx.fillStyle = isBad ? 'rgba(50, 50, 50, 0.8)' : 'rgba(200, 0, 0, 0.8)';
      ctx.fill();
      ctx.lineWidth = 10;
      ctx.strokeStyle = isBad ? '#7f8c8d' : '#f1c40f';
      ctx.stroke();

      // æ–‡å­—
      ctx.font = '140px Arial, "Microsoft YaHei", sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = 'white';
      ctx.fillText(text, 128, 138); // å¾®èª¿å‚ç›´ä½ç½®

      return canvas.toDataURL();
    }

    // --- éŠæˆ²é‚è¼¯å…ƒä»¶ ---
    AFRAME.registerComponent('floating-item', {
      schema: {
        type: { type: 'string', default: 'good' }, // good or bad
        value: { type: 'string', default: '' }
      },
      init: function() {
        this.isHit = false;
        
        // éš¨æ©Ÿåˆå§‹ä½ç½® (åœ¨ç›¸æ©Ÿå‰æ–¹)
        // X: -2 ~ 2 (å·¦å³)
        // Y: -1 ~ 1 (ä¸Šä¸‹)
        // Z: -3 ~ -5 (æ·±åº¦ï¼Œå¾é è™•å‡ºç¾)
        const startX = (Math.random() - 0.5) * 4;
        const startY = (Math.random() - 0.5) * 3;
        const startZ = -4 - (Math.random() * 2); 
        
        this.el.setAttribute('position', `${startX} ${startY} ${startZ}`);
        
        // éš¨æ©Ÿç§»å‹•æ–¹å‘ (ç¨å¾®é£„å‹•)
        this.direction = {
          x: (Math.random() - 0.5) * 0.01,
          y: (Math.random() - 0.5) * 0.01,
          z: 0.02 + Math.random() * 0.01 // ä¸»è¦æ˜¯å¾€ç›¸æ©Ÿæ–¹å‘é£› (Zè»¸æ­£å‘)
        };
      },
      tick: function() {
        if (this.isHit) return;

        const pos = this.el.getAttribute('position');
        
        // ç§»å‹•
        pos.x += this.direction.x;
        pos.y += this.direction.y;
        pos.z += this.direction.z;
        this.el.setAttribute('position', pos);

        // æ—‹è½‰æ•ˆæœ
        this.el.object3D.rotation.z += 0.01;

        // å¦‚æœå¤ªé è¿‘ç›¸æ©Ÿ (ç©¿éè¢å¹•)ï¼Œå°±ç§»é™¤
        if (pos.z > 1) {
          this.el.parentNode.removeChild(this.el);
          return;
        }

        // --- ç¢°æ’åµæ¸¬ ---
        // åªæœ‰ç•¶æ¨™è¨˜è¢«åµæ¸¬åˆ°æ™‚æ‰è¨ˆç®—
        if (playerMarker.object3D.visible) {
          // å–å¾—ã€Œç©å®¶ç¢°æ’å™¨ã€çš„ä¸–ç•Œåº§æ¨™
          const playerPos = new THREE.Vector3();
          playerCollider.object3D.getWorldPosition(playerPos);

          // å–å¾—ã€Œè‡ªå·±ã€çš„ä¸–ç•Œåº§æ¨™
          const myPos = new THREE.Vector3();
          this.el.object3D.getWorldPosition(myPos);

          // è¨ˆç®—è·é›¢
          const distance = playerPos.distanceTo(myPos);

          if (distance < COLLISION_DISTANCE) {
            this.handleCollision();
          }
        }
      },
      handleCollision: function() {
        this.isHit = true;
        
        // æ›´æ–°åˆ†æ•¸
        const points = this.data.type === 'good' ? 15 : -5;
        updateScore(points);

        // æ’­æ”¾ç°¡å–®çš„æ¶ˆå¤±å‹•ç•«
        this.el.setAttribute('animation', {
          property: 'scale',
          to: '0 0 0',
          dur: 200,
          easing: 'easeInQuad'
        });

        // å‹•ç•«çµæŸå¾Œç§»é™¤ DOM
        setTimeout(() => {
          if (this.el.parentNode) {
            this.el.parentNode.removeChild(this.el);
          }
        }, 200);
      }
    });

    // --- åˆ†æ•¸æ›´æ–° UI ---
    function updateScore(points) {
      score += points;
      scoreEl.innerText = score;

      // é¡¯ç¤ºæµ®å‹•åˆ†æ•¸å‹•ç•«
      scoreAnimEl.innerText = points > 0 ? `+${points}` : points;
      scoreAnimEl.style.color = points > 0 ? '#4cd137' : '#e84118';
      scoreAnimEl.style.opacity = '1';
      scoreAnimEl.style.transform = 'translateY(-20px)';
      
      // å–å¾—æ¨™è¨˜åœ¨è¢å¹•ä¸Šçš„å¤§æ¦‚ä½ç½® (ç°¡åŒ–è™•ç†ï¼Œç›´æ¥é¡¯ç¤ºåœ¨åˆ†æ•¸æ¿æ—)
      // é€™è£¡ç‚ºäº†ç°¡å–®ï¼Œå›ºå®šåœ¨å·¦ä¸Šè§’é¡¯ç¤ºå‹•ç•«
      
      setTimeout(() => {
        scoreAnimEl.style.opacity = '0';
        scoreAnimEl.style.transform = 'translateY(0)';
      }, 600);
    }

    // --- ç”Ÿæˆå™¨ ---
    setInterval(() => {
      // æ±ºå®šç”Ÿæˆå“ªä¸€ç¨® (70% æ©Ÿç‡æ˜¯å­—è©, 30% æ˜¯é›œç‰©)
      const isGood = Math.random() > 0.3;
      const dataSet = isGood ? GOOD_WORDS : BAD_WORDS;
      const text = dataSet[Math.floor(Math.random() * dataSet.length)];
      
      // å»ºç«‹å¯¦é«”
      const el = document.createElement('a-plane');
      
      // è¨­å®šæè³ª (ä½¿ç”¨ Canvas ç”Ÿæˆçš„åœ–ç‰‡)
      const textureUrl = createTextTexture(text, !isGood);
      el.setAttribute('material', {
        src: textureUrl,
        transparent: true,
        opacity: 1,
        shader: 'flat' // ä¸å—å…‰ç…§å½±éŸ¿ï¼Œä¿æŒæ¸…æ™°
      });

      el.setAttribute('width', '1');
      el.setAttribute('height', '1');
      el.setAttribute('scale', '0.5 0.5 0.5');
      
      // åŠ å…¥è‡ªå®šç¾©å…ƒä»¶
      el.setAttribute('floating-item', {
        type: isGood ? 'good' : 'bad',
        value: text
      });

      // è®“ç‰©ä»¶é¢å‘ç›¸æ©Ÿ (Billboard æ•ˆæœ)
      el.setAttribute('look-at', '[camera]');

      // å°‡ç‰©ä»¶æ›åœ¨ cameraRig ä¸‹ï¼Œé€™æ¨£å®ƒæœƒè·Ÿè‘—æ‰‹æ©Ÿè½‰å‹• (HUD æ¨¡å¼)
      // æˆ–è€…æ›åœ¨ scene ä¸‹ (World æ¨¡å¼)ã€‚
      // ç‚ºäº†è®“éŠæˆ²å¥½ç©ï¼Œæˆ‘å€‘æ›åœ¨ camera ä¸‹ï¼Œé€™æ¨£å­—æœƒä¸€ç›´å‡ºç¾åœ¨è¢å¹•è¦–é‡å…§ï¼Œ
      // ç©å®¶å¿…é ˆç§»å‹•ã€Œæ‰‹ä¸Šçš„æ¨™è¨˜ã€å»è¿½é€™äº›å­—ã€‚
      cameraRig.appendChild(el);

    }, SPAWN_INTERVAL);

  </script>
</body>
</html>
